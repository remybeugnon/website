<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu du Renne</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #f0f0f0;
        }

        #gameCanvas {
            background-color: #fff;
            display: block;
            margin: auto;
            border: 2px solid #000;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
            font-family: Arial, sans-serif;
            color: red;
        }

        /* Style pour le titre */
        .game-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            font-family: Arial, sans-serif;
            color: #333;
        }
    </style>
</head>
<body>

<!-- Titre en haut de la page -->
<div class="game-title">La liste cachée!</div>

<canvas id="gameCanvas"></canvas>
<div class="game-over" id="gameOver" style="display: none;">Jeu terminé ! Appuyez sur R pour recommencer.</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Ajuster la taille du canvas en fonction de la taille de l'écran
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const renneImage = new Image(); 
    renneImage.src = 'renne.png'; 

    const sapinImage = new Image(); 
    sapinImage.src = 'sapin.png'; 

    const renne = {
        x: 50,
        y: 150,
        width: 40,
        height: 40,
        velocityY: 0,
        jumpPower: -6,
        gravity: 0.1,
        jumping: false,
        jumpHoldTime: 0,
    };

    const obstacles = [];
    const obstacleWidth = 40;
    const obstacleHeight = 40;
    let obstacleSpeed = 0.8;
    const maxObstacles = 3;
    const minObstacleSpacing = 150;
    let score = 0;

    let gameOver = false;
    let timeElapsed = 0;

    // Gestion du saut avec le clavier
    document.addEventListener('keydown', (event) => {
        if (event.key === ' ' && !renne.jumping && !gameOver) {
            renne.jumping = true;
            renne.velocityY = renne.jumpPower;
            renne.jumpHoldTime = 0;
        }
    });

    // Gestion du saut avec un clic ou un toucher
    canvas.addEventListener('click', () => {
        if (!renne.jumping && !gameOver) {
            renne.jumping = true;
            renne.velocityY = renne.jumpPower;
            renne.jumpHoldTime = 0;
        }
    });

    function drawRenne() {
        ctx.drawImage(renneImage, renne.x, renne.y, renne.width, renne.height);
    }

    function createObstacle() {
        if (obstacles.length === 0 || obstacles[obstacles.length - 1].x < canvas.width - minObstacleSpacing) {
            const obstacleX = canvas.width;
            const obstacleY = canvas.height - obstacleHeight;
            obstacles.push({ x: obstacleX, y: obstacleY });
        }
    }

    function drawObstacles() {
        for (let i = 0; i < obstacles.length; i++) {
            ctx.drawImage(sapinImage, obstacles[i].x, obstacles[i].y, obstacleWidth, obstacleHeight);
        }
    }

    function moveObstacles() {
        for (let i = 0; i < obstacles.length; i++) {
            obstacles[i].x -= obstacleSpeed;

            if (obstacles[i].x < renne.x + renne.width &&
                obstacles[i].x + obstacleWidth > renne.x &&
                obstacles[i].y < renne.y + renne.height &&
                obstacles[i].y + obstacleHeight > renne.y) {
                gameOver = true;
                document.getElementById('gameOver').style.display = 'block';
            }

            if (obstacles[i].x + obstacleWidth < 0) {
                obstacles.splice(i, 1);
                score++;
            }
        }
    }

    function updateRenne() {
        if (renne.jumping) {
            renne.velocityY += renne.gravity;
            renne.y += renne.velocityY;

            if (renne.y >= 150) {
                renne.y = 150;
                renne.jumping = false;
            }
        }
    }

    function drawScore() {
        ctx.fillStyle = '#000';
        ctx.font = '20px Arial';
        ctx.fillText('Score: ' + score, 20, 30);
    }

    function restartGame() {
        score = 0;
        obstacles.length = 0;
        renne.y = 150;
        renne.velocityY = 0;
        renne.jumping = false;
        renne.jumpHoldTime = 0;
        gameOver = false;
        timeElapsed = 0;
        obstacleSpeed = 0.8;
        document.getElementById('gameOver').style.display = 'none';
        gameLoop();
    }

    // Rediriger après un score de 10
    function checkScore() {
        if (score >= 10 && !gameOver) {
            window.location.href = 'liste.html'; // Redirige vers liste.html
        }
    }

    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (gameOver) return;

        drawRenne();
        drawObstacles();
        moveObstacles();
        updateRenne();
        drawScore();

        // Vérification du score pour rediriger vers liste.html
        checkScore();

        if (Math.random() < 0.005) {
            createObstacle();
        }

        timeElapsed++;
        if (timeElapsed % 100 === 0) {
            obstacleSpeed += 0.05;
        }

        requestAnimationFrame(gameLoop);
    }

    renneImage.onload = function () {
        sapinImage.onload = function () {
            gameLoop(); // Démarrer le jeu une fois que les images sont chargées
        };
    };
</script>

</body>
</html>